const t=t=>"function"==typeof t,n=Object.prototype.toString,e=t=>"[object Object]"===n.call(t),o=t=>n.call(t),c=Object.keys,{hasOwnProperty:s}=Object.prototype,a=t=>{throw new Error(t)},i=my,r=(t=!1)=>({page:["onLoad","onUnload"],component:[t?"onInit":"didMount","didUnmount"]});function f(n){e(n)||a("provider必须是一个Object");const{store:o,namespace:c="",component2:s=!1}=n;o&&t(o.getState)&&t(o.dispatch)&&t(o.subscribe)||a("store必须为Redux的Store实例对象"),i.__REDUX_BINDINGS_PROVIDER__={store:o,lifetimes:r(s),namespace:c}}function u(){return i.__REDUX_BINDINGS_PROVIDER__||a("请先设置provider"),i.__REDUX_BINDINGS_PROVIDER__}const p=()=>u().store,l=()=>u().store.getState(),g=()=>u().store.dispatch;function h(t){const{store:n}=u();let e=n.getState();return n.subscribe(()=>{const o=n.getState();t(o,e),e=o})}function d(t){const{store:n}=u(),e={};return Object.defineProperty(e,"value",{configurable:!1,enumerable:!0,get:()=>t(n.getState())}),e}function b(t,n){if(!Array.isArray(n)||n.length<1)return t;let e,o={};return function(c){return n.some(t=>o[t]!==c[t])&&(o=c,e=t(c)),e}}function m(t){const n=l(),o={};for(let c=0,a=t.length;c<a;c++){const a=t[c];switch(typeof a){case"string":s.call(n,a)&&(o[a]=n[a]);break;case"function":{const t=a(n);e(t)&&Object.assign(o,t);break}}}return o}function y(n,o){e(n)?function(n,e){const o=g(),s=c(n);for(let c=0,a=s.length;c<a;c++){const a=s[c],i=n[a];t(i)&&(e[a]=(...t)=>o(i.apply(null,t)))}}(n,o):t(n)&&function(t,n){const o=t(g());e(o)||a("mapDispatch函数必须返回一个对象"),Object.assign(n,o)}(n,o)}function j(t,n,e,s){const a=c(t),i=c(n),r=a.length,f=i.length;if(!(r<1&&f<1))if(r<1||f<1||r<f)e[s]=t;else{for(let n=0;n<f;n++){const o=i[n];if(a.indexOf(o)<0)return void(e[s]=t)}for(let c=0;c<r;c++){const r=a[c],f=t[r],u=`${s}.${r}`;if(i.indexOf(r)<0){e[u]=f;continue}const p=n[r];if(f!==p){const t=o(f);t!==o(p)?e[u]=f:"[object Object]"===t?j(f,p,e,u):"[object Array]"===t?O(f,p,e,u):e[u]=f}}}}function O(t,n,e,c){const s=t.length,a=n.length;if(!(s<1&&a<1))if(s<1||a<1||s<a)e[c]=t;else for(let i=0;i<s;i++){const s=t[i],r=`${c}[${i}]`;if(i>=a){e[r]=s;continue}const f=n[i];if(s!==f){const t=o(s);t!==o(f)?e[r]=s:"[object Object]"===t?j(s,f,e,r):"[object Array]"===t?O(s,f,e,r):e[r]=s}}}function _(t,n,e=""){const s=c(t),a=c(n),i=s.length,r=a.length;if(i<1&&r<1)return{};if(i<1||r<1)return e?{[e]:t}:t;const f={};for(let c=0;c<i;c++){const i=s[c],r=t[i],u=e?`${e}.${i}`:i;if(a.indexOf(i)<0){f[u]=r;continue}const p=n[i];if(r!==p){const t=o(r);t!==o(p)?f[u]=r:"[object Object]"===t?j(r,p,f,u):"[object Array]"===t?O(r,p,f,u):f[u]=r}}return f}const D=[];function S(){if(D.length<1)return;let t;for(;t=D.shift();){const n=_(t.updater,t.data,t.rootPath);c(n).length>0&&t.setData(n)}}function I(t,n){return h((o,s)=>{const a={};for(let t=0,c=n.length;t<c;t++){const c=n[t];switch(typeof c){case"string":o[c]!==s[c]&&(a[c]=o[c]);break;case"function":{const t=c(o);e(t)&&Object.assign(a,t);break}}}c(a).length>0&&function({id:t,data:n,setData:e},o){const c=D.find(n=>n.id===t);c?Object.assign(c.updater,o):D.push({id:t,rootPath:u().namespace,data:Object.assign({},n),updater:o,setData:e}),Object.assign(n,o),Promise.resolve().then(S)}(t,a)})}const R=Symbol("INSTANCE_ID");function P({type:t="page",mapState:n,mapDispatch:e,manual:o=!1}={}){"page"!==t&&"component"!==t&&a("type属性只能是page或component");const s="page"===t,{lifetimes:i,namespace:r}=u();return function(a){if(Array.isArray(n)&&n.length>0){const e=m(n);a.data=Object.assign(a.data||{},r?{[r]:e}:e);const o=new Map,[s,f]=i[t],u=a[s],p=a[f];a[s]=function(...t){const e=()=>r?this.data[r]:this.data,s=_(m(n),e(),r);c(s).length>0&&this.setData(s);const a=Symbol("instanceId"),i=I({id:a,data:e(),setData:this.setData.bind(this)},n);o.set(a,i),this[R]=a,u&&u.apply(this,t)},a[f]=function(){p&&p.apply(this);const t=this[R];if(o.has(t)){const n=o.get(t);o.delete(t),n()}}}if(e){const t=s?a:a.methods=a.methods||{};y(e,t)}return o?a:s?Page(a):Component(a)}}function A(t={}){return t.type="page",P(t)}function E(t={}){return t.type="component",P(t)}export{E as $component,A as $page,P as connect,f as setProvider,g as useDispatch,d as useRef,b as useSelector,l as useState,p as useStore,h as useSubscribe};
